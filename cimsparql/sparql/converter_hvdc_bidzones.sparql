# Name: Converter HVDC bidzones
PREFIX cim:<${cim}>
PREFIX SN:<${SN}>
PREFIX ALG:<${ALG}>

select distinct ?mrid ?from_area ?to_area
where
{
  values ?converters {
    cim:VsConverter cim:ACDCConverter cim:CsConverter cim:DCConvertUnit
    ALG:ACDCConverter ALG:CsConverter ALG:DCConverter ALG:VoltageSourceConverter ALG:VsConverter
  }
  # Find all converters and the corresponding substation
  ?converter cim:Equipment.EquipmentContainer/cim:VoltageLevel.Substation ?substation;
             cim:IdentifiedObject.mRID ?mrid ;
             a ?converters .

  # Find market delivery point for the substation
  ?substation SN:Substation.MarketDeliveryPoint ?delivery_point .
  ?delivery_point SN:MarketDeliveryPoint.BiddingArea/SN:BiddingArea.marketCode ?from_area .

  # Extract the destination point from the line that has one end matching from_area
  ?line SN:Line.FromMarketDeliveryPoint ?delivery_point;
        SN:Line.ToMarketDeliveryPoint/SN:MarketDeliveryPoint.BiddingArea/SN:BiddingArea.marketCode ?to_area
  filter(?from_area != ?to_area)
}
